## 第二章

### 2.1

存储操作数的操作单元：堆栈、累加器、通用寄存器组

通用寄存器分为：RM结构、RR结构、MM结构（很少用）（R— 寄存器、M存储器）

通用寄存器优势（灵活性、提高性能方面）：

- 寄存器的访问速度比存储器快
- 对编译器而言，能更加容易、有效地分配和使用寄存器
- 寄存器可以用来存放变量

根据ALU指令的操作数个数，对通用寄存器型指令集进行进一步细分：

- ALU指令的操作数个数
- ALU指令的存储器操作数个数
- 具体表 28页表2.2

| 指令集结构类型 | 优点                                       | 缺点                         |
| ------- | ---------------------------------------- | -------------------------- |
| RR      | 指令字长固定，指令结构简洁，执行时钟周期数相近                  | 指令条数多，目标代码不够紧凑，程序占用空间大     |
| RM      | 可以在ALU指令中直接对存储器操作数进行引用，容易对指令进行编码，目标代码比较紧凑 | 两个操作数不对称，限制寄存器个数，执行时钟周期差别大 |
| MM      | 目标代码紧凑，不需要寄存器保存变量                        | 指令字长变化大，每条指令工作差别大，存储器频繁访问  |

### 2.2

寻址方式：一种指令集结构如何确定所有访问的数据的地址

有效地址：由寻址方式确定的实际存储器地址

表2.4 操作数寻址方式

多种寻址方式：减少程序的指令条数 增加复杂度、CPI

立即数寻址方式、偏移寻址方式频度最高 一些性质31-32页

### 2.3

确定功能由什么实现，考虑的因素：速度、成本、灵活性

- 硬件：速度快、成本高、灵活性低
- 软件：速度低、成本低、灵活性高

指令集基本要求：

- 完整性
  - 有限可用的存储空间内，对于任何可解问题编程，指令集提供的指令足够使用
  - 功能齐全、使用方便
- 规整性
  - 对称性：所有与指令集相关的存储单元使用、操作码设置都是对称的
  - 均匀性：对各种不同的操作数类型、字长、操作种类和数据存储单元，指令设置要同等对待
- 高效率
  - 指令的执行速度快、使用频率高
- 兼容性


CISC指令集：

- 追求目标：强化指令功能、减少指令条数，以达到提高性能的目的
- 增强指令功能从以下几个方面：
  - 面向目标程序增强指令功能
    - 面向目标程序优化指令集释提高计算机性能的最直接的方法
    - 增强运算型指令功能
    - 增强数据传送指令的功能
    - 增强程序控制指令的功能
  - 面向高级语言的优化实现来改进指令集
    - 高级语言与一般的机器语言的语义差距非常大。一方面：编译器本身比较复杂；二方面：编译生成的目标代码比较难以达到好的优化
    - 增强对高级语言和编译器的支持（35页）
    - 使用高级语言计算机（36页）
    - 面向操作系统的优化实现改进指令集（36-37页）

CISC指令集存在的问题：

- 各种指令的使用频度相差悬殊，许多指令很少用到
- 指令集庞大，指令条数很多，许多指令的功能又很复杂
- 许多指令操作繁杂，CPI值比较大，执行速度慢；有可能使整个程序的执行时间反而增加
- 指令功能复杂，规整性不好，不利于采用流水技术来提高性能

RISC计算机设计遵循原则：

- 指令条数少而简单，只选取使用频度很高的指令
- 采用简单而统一的指令格式，减少寻址方式。字长32位or64位
- 指令的执行在单个机器周期内完成（流水线后）
- load和store才能访问存储器，采用load-store结构
- 大多数指令都采用硬连逻辑来实现
- 强调优化编译器的作用，为高级程序语言生成优化的代码
- 充分利用流水技术

早起RISC微处理器特点：

- load-store结构
- 字长为32位
- 高效的流水技术

控制指令

- 分类
  - 跳转：无条件改变控制流指令
  - 分支：有条件改变控制流指令
- 改变控制流的指令：条件分支、跳转、过程调用、过程返回（分支占大半部分）

3种表示分支条件的主要方法

| 名称      | 方法                           | 优点            | 缺点                                |
| ------- | ---------------------------- | ------------- | --------------------------------- |
| 条件码（CC） | 检测由ALU操作设置的一些特殊位(CC)         | 自由设置分支条件      | 条件码是增设的状态；限制了指令的执行顺序（确保条件码能够顺利传送） |
| 条件寄存器   | 比较指令把比较结果放入一个寄存器，需要的时候检测该寄存器 | 简单            | 占用了一个寄存器                          |
| 比较与分支   | 比较操作作为分支指令的一部分，通常这种比较是受限制的   | 一条指令（非两条）实现分支 | 流水方式时，该指令的操作太多，无法在一拍内做完           |

转移地址的表示（显式）

- 最常用的方法：指令中提供一个偏移量，偏移量加程序计数器(PC) — — PC相对寻址
  - 优点
    - 有效减少表示该目标地址所需的位数(一般目标地址离当前指令很近)
    - 位置无关(代码可以被转载到主存的任意位置)
  - 4～8位偏移量字段足够表示大多数转移目标地址

过程调用和返回

- 除了改变控制流，还要保存机器状态、返回地址(专门的链接寄存器、堆栈)
- 过去：专门的保存机制
- 现在：编译器生成load和store指令来保存或恢复寄存器

### 2.4

数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型

数据结构：软件进行处理和实现的各种数据类型

如何确定数据表示：系统结构设计者要解决的问题（软硬件取舍折中）

表示操作数类型的方法

- 指令中操作码指定操作数的类型 常用
- 带标志符的数据表示 少见
- 41页

操作数大小

- 字节 8位；半字 16位；字 32位；双字 64 位
- 字符 ASCII码 一个字节
- 整数 二进制补码 字节、半字、字
- 浮点操作数 单精度浮点数 1个字；双精度浮点数 双字
- 十进制操作数类型 41页

访问频度 单字、双字的高

### 2.5

指令组成：操作码、地址码

指令格式的设计：确定指令字的编码方式，操作码和地址码的编码和表示方式

操作码：

- Huffman码，变长，不规整，不利于硬件处理
- 固定长度操作码，保证译码速度

寻址方式：

- 编码于操作码中，操作码描述寻址方式。load-store结构，寻址方式少
- 专门的地址描述符。多种寻址方式，指令操作数多

考虑因素：

- 寄存器个数、寻址方式的数目对指令平均字长的影响、目标代码大小的影响
- 指令易于硬件处理，特别是流水实现
- 指令字长是字节(8位)的整数倍

编码格式

- 变长编码格式
  - 寻址方式和操作种类很多时候，最好
  - 最少的二进制位来表示目标代码
  - 可能使各条指令的字长和执行时间差异很大
- 固定长度编码格式
  - 操作类型、寻址方式一起编码到操作码当中
  - 寻址方式和操作类型很少时，最好
  - 降低译码的复杂度，提高译码速度
  - RISC指令集采用该编码格式
- 混合型编码格式
  - 提供若干种固定的指令字长
  - 减少目标代码长度、降低译码复杂度